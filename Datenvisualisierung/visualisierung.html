<html>

<head>
    <script src="https://d3js.org/d3.v5.js"></script>

    <style>
        .plus:hover {
            cursor: pointer;
        }

        .plus:hover circle.background {
            fill: lightblue;
        }

        svg text {
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif
        }
    </style>
</head>

<body>
    <svg style="width: 95%; height: 95%">
        <g id="all">
            <image xlink:href="UmrissWien.png" x="0" y="0" height="560" width="750" class="vienna" />





        </g>


    </svg>

    <script lang="text/javascript">
        function drawHouse(parentSelector, text, x, y, w, h) {
            var points = [[-45, 50], [45, 50], [45, -4], [50, 0], [50, -10], [0, -50], [- 50, -10], [- 50, 0], [- 45, -4]];
            var pointsStr = "";
            for (var i = 0; i < points.length; i++) {
                pointsStr += (points[i][0] * w / 100 + x) + "," + (points[i][1] * h / 100 + y) + " ";
            }
            var parent = d3.select(parentSelector);
            var group = parent.append("g");
            var image = group.append("image")
                .attr("x", x - 130)
                .attr("y", y - h / 2.75)
                .attr("width", 250)
                .attr("height", h / 1.25)
                .attr("xlink:href", "Person.png");

            var circles = group.append("g")
                .attr("transform", "translate(" + (x + 5) + " " + (y - 55) + ")");

            circles.append("circle")
                .attr("cx", "15")
                .attr("cy", "0")
                .attr("r", "5")
                .attr("fill", "red");
            circles.append("circle")
                .attr("cx", "35")
                .attr("cy", "50")
                .attr("r", "5")
                .attr("fill", "red");
            circles.append("circle")
                .attr("cx", "25")
                .attr("cy", "100")
                .attr("r", "5")
                .attr("fill", "red");
            circles.append("circle")
                .attr("cx", "0")
                .attr("cy", "45")
                .attr("r", "5")
                .attr("fill", "red");

            var house = group.append("polygon")
                .attr("points", pointsStr)
                .attr("fill", "none")
                .attr("stroke", "black")
                .attr("stroke-width", "1.5");
            var text = group.append("text")
                .attr("x", x)
                .attr("y", y + h / 2 + 18)
                .attr("fill", "black")
                .attr("text-anchor", "middle")
                .attr("font-size", "20px")
                .attr("font-weight", "bold")
                .text(text);
            var zoom = group.append("g")
                .attr("transform", "translate(" + (x + w / 2.85) + " " + (y - h / 2.85) + ") scale(0.3 0.3)")
                .attr("class", "plus");

            zoom.append("circle")
                .attr("cx", "0")
                .attr("cy", "0")
                .attr("r", "45")
                .attr("fill", "white")
                .attr("stroke-width", "0")
                .attr("class", "background");
            zoom.append("circle")
                .attr("cx", "0")
                .attr("cy", "0")
                .attr("r", "45")
                .attr("fill", "none")
                .attr("stroke-width", "7.5")
                .attr("stroke", "blue");
            zoom.append("line")
                .attr("x1", "-17.5")
                .attr("y1", "0")
                .attr("x2", "17.5")
                .attr("y2", "0")
                .attr("stroke-width", "5")
                .attr("stroke", "blue");
            zoom.append("line")
                .attr("x1", "0")
                .attr("y1", "-17.5")
                .attr("x2", "0")
                .attr("y2", "17.5")
                .attr("stroke-width", "5")
                .attr("stroke", "blue")
                .attr("class", "plus");

            return group;
        }

        var zoomed = false;
        var home = drawHouse("#all", "Zu Hause", 190, 330, 180, 200);
        var nursing = drawHouse("#all", "In der Pflegeeinrichtung", 500, 260, 300, 200);
        home.attr("class", "home")
            .select("g.plus").on("click", function (event) {
                d3.select(this).select("line.plus").attr("stroke", zoomed ? "blue" : "none");
                d3.select("#all").transition().duration(750).attr("transform", zoomed ? "" : "translate(-120 -550) scale(2.5 2.5)");
                d3.select("image.vienna").transition().duration(750).style("opacity", zoomed ? "1" : "0");
                nursing.transition().duration(750).style("opacity", zoomed ? "1" : "0");
                zoomed = !zoomed;
            });
        nursing.attr("class", "nursing")
            .select("g.plus").on("click", function (event) {
                d3.select(this).select("line.plus").attr("stroke", zoomed ? "blue" : "none");
                d3.select("#all").transition().duration(750).attr("transform", zoomed ? "" : "translate(-800 -380) scale(2.5 2.5)");
                d3.select("image.vienna").transition().duration(750).style("opacity", zoomed ? "1" : "0");
                home.transition().duration(750).style("opacity", zoomed ? "1" : "0");
                zoomed = !zoomed;
            });

        var percentColors = [
            { pct: 0.0, color: { r: 0xff, g: 0x00, b: 0 } },
            { pct: 0.5, color: { r: 0xff, g: 0xff, b: 0 } },
            { pct: 1.0, color: { r: 0x00, g: 0xff, b: 0 } }];

        var getColorForPercentage = function (pct) {
            for (var i = 1; i < percentColors.length - 1; i++) {
                if (pct < percentColors[i].pct) {
                    break;
                }
            }
            var lower = percentColors[i - 1];
            var upper = percentColors[i];
            var range = upper.pct - lower.pct;
            var rangePct = (pct - lower.pct) / range;
            var pctLower = 1 - rangePct;
            var pctUpper = rangePct;
            var color = {
                r: Math.floor(lower.color.r * pctLower + upper.color.r * pctUpper),
                g: Math.floor(lower.color.g * pctLower + upper.color.g * pctUpper),
                b: Math.floor(lower.color.b * pctLower + upper.color.b * pctUpper)
            };
            return 'rgb(' + [color.r, color.g, color.b].join(',') + ')';
            // or output as hex if preferred

        }

        var perc = 1 / 10;
        d3.select(".head").attr("fill", getColorForPercentage(perc)).attr("r", 50 * perc);

        d3.dsv(";", "Sturzdaten.csv")
            .then(function (data) {
                console.log(data);
            })
    </script>
</body>

</html>