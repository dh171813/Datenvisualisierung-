<html>

<head>
    <script src="https://d3js.org/d3.v5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>

    <style>
        .plus:hover {
            cursor: pointer;
        }

        g.circles>circle:hover {
            cursor: pointer;
        }

        .plus:hover circle.background {
            fill: lightblue;
        }

        svg text {
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif
        }


        div.tooltip {
            position: absolute;
            text-align: center;
            width: 85px;
            height: 28px;
            padding: 2px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }

        svg {
            float: left;
        }

        .canvas {
            float: right;
        }

        h1, .source {
            font: 30px sans-serif;
            color: rgb(0, 0, 0);
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            text-align:center;
        }

        .source {
            font-size: 15px;
            position: absolute;
            bottom: -30px;
        }
        
    </style>
</head>

<body>
    <h1>Sturzdaten Wien</h1>
    <svg style="width: 60%; height: 95%">
        <g id="all">
            <image xlink:href="UmrissWien.png" x="0" y="-10" height="560" width="750" class="vienna" />
            <!-- durch Javascript-Funktionen kommen hier mehr Infos/Bilder dazu -->
        </g>
        
    </svg>
    
    <div width="35%" height="45%" class="canvas">
        <canvas id="up-chart"> </canvas>
    </div>


    <div width="35%" height="45%" class="canvas">
        <canvas id="down-chart"> </canvas>
    </div>

    <p class="source">Quelle:https://data.opendataportal.at/dataset/708b3bbd-bc18-4f01-8e16-5b1efc9efb77</p>

    <script lang="text/javascript">
        function drawHouse(parentSelector, text, x, y, w, h, color) {
            var points = [[-45, 50], [45, 50], [45, -4], [50, 0], [50, -10], [0, -50], [- 50, -10], [- 50, 0], [- 45, -4]];
            var pointsStr = "";
            for (var i = 0; i < points.length; i++) {
                pointsStr += (points[i][0] * w / 100 + x) + "," + (points[i][1] * h / 100 + y) + " ";
            }
            var parent = d3.select(parentSelector);
            var group = parent.append("g");
            var house = group.append("polygon")
                .attr("points", pointsStr)
                .attr("fill", color)
                .attr("fill-opacity", "0.5")
                .attr("stroke", "black")
                .attr("stroke-width", "1.5")
            var image = group.append("image")
                .attr("x", x - 130)
                .attr("y", y - h / 2.75)
                .attr("width", 250)
                .attr("height", h / 1.25)
                .attr("xlink:href", "Person_transparent.png");
            var circles = group.append("g")
                .attr("class", "circles")
                .attr("transform", "translate(" + (x + 5) + " " + (y - 55) + ")");
            circles.append("circle")
                .attr("cx", "15")
                .attr("cy", "0")
                .attr("r", "5")
                .attr("fill", "red")
                .attr("class", "head");
            circles.append("circle")
                .attr("cx", "35")
                .attr("cy", "50")
                .attr("r", "5")
                .attr("fill", "red")
                .attr("class", "upperEx");
            circles.append("circle")
                .attr("cx", "25")
                .attr("cy", "100")
                .attr("r", "5")
                .attr("fill", "red")
                .attr("class", "lowerEx");
            circles.append("circle")
                .attr("cx", "0")
                .attr("cy", "45")
                .attr("r", "5")
                .attr("fill", "red")
                .attr("class", "back");
            var text = group.append("text")
                .attr("x", x)
                .attr("y", y + h / 2 + 18)
                .attr("fill", "black")
                .attr("text-anchor", "middle")
                .attr("font-size", "20px")
                .attr("font-weight", "bold")
                .text(text);
            var falls = group.append("text")
                .attr("x", x - w / 2)
                .attr("y", y + h / 2.5)
                .attr("fill", "black")
                .attr("text-anchor", "end")
                .attr("font-size", "15px")
                .attr("font-weight", "bold")
                .text((unescape("St%FCrze%0A")));
            var fallsNumber = group.append("text")
                .attr("x", x - w / 2)
                .attr("y", y + h / 2.5 - 15)
                .attr("fill", "black")
                .attr("text-anchor", "end")
                .attr("font-size", "15px")
                .attr("font-weight", "bold")
                .attr("class", "falls")
                .text("--");
            var zoom = group.append("g")
                .attr("transform", "translate(" + (x + w / -2.85) + " " + (y - h / 2.85) + ") scale(0.3 0.3)")
                .attr("class", "plus");
            zoom.append("circle")
                .attr("cx", "0")
                .attr("cy", "0")
                .attr("r", "45")
                .attr("fill", "white")
                .attr("stroke-width", "0")
                .attr("class", "background");
            zoom.append("circle")
                .attr("cx", "0")
                .attr("cy", "0")
                .attr("r", "45")
                .attr("fill", "none")
                .attr("stroke-width", "7.5")
                .attr("stroke", "blue");
            zoom.append("line")
                .attr("x1", "-17.5")
                .attr("y1", "0")
                .attr("x2", "17.5")
                .attr("y2", "0")
                .attr("stroke-width", "5")
                .attr("stroke", "blue");
            zoom.append("line")
                .attr("x1", "0")
                .attr("y1", "-17.5")
                .attr("x2", "0")
                .attr("y2", "17.5")
                .attr("stroke-width", "5")
                .attr("stroke", "blue")
                .attr("class", "plus");

            return group;
        }
        
        var zoomed = false;

        //STÜRZE 
        var homeCount = 0;
        var nursingCount = 0;

        //VERLETZUNGEN
        var head = [0, 0];
        var upperEx = [0, 0];
        var lowerEx = [0, 0];
        var back = [0, 0];

        var headInj = [0, 0];
        var face = [0, 0];
        var shoulder = [0, 0];
        var arm = [0, 0];
        var elbow = [0, 0];
        var hand = [0, 0];
        var hips = [0, 0];
        var tigh = [0, 0];
        var knees = [0, 0];
        var feet = [0, 0];
        var leg = [0, 0];
        var neck = [0, 0];
        var backInj = [0, 0];
        var chest = [0, 0];
        var spine = [0, 0];


        //GESCHLECHT
        var male = [0, 0];
        var female = [0, 0];

        // Medicine variable
        var noDetails = [0, 0];
        var marcoumar = [0, 0];
        var thromboAss = [0, 0];
        var lovenox = [0, 0];
        var daflon = [0, 0];
        var mulit = [0, 0];

        var chartUp;
        var chartDown;

        var home = drawHouse("#all", "Zu Hause", 190, 330, 180, 200, "#3cba9f");
        var nursing = drawHouse("#all", "In der Pflegeeinrichtung", 500, 260, 300, 200, "#3e95cd");

        home.attr("class", "home")
            .select("g.plus").on("click", function (event) {
                d3.select(this).select("line.plus").attr("stroke", zoomed ? "blue" : "none");
                d3.select("#all").transition().duration(750).attr("transform", zoomed ? "" : "translate(-120 -550) scale(2.4 2.4)");
                d3.select("image.vienna").transition().duration(750).style("opacity", zoomed ? "1" : "0");
                nursing.transition().duration(750).style("opacity", zoomed ? "1" : "0");
                chartUp.destroy();
                chartDown.destroy();
                if (zoomed) {
                    chartUp = new Chart(document.getElementById('up-chart'), {
                        type: "pie",
                        data: {
                            datasets: [{
                                label: 'test',
                                data: [homeCount, nursingCount],
                                backgroundColor: ['#3cba9f', '#3e95cd']
                            }, {

                            }],
                            labels: ['Zu Hause', 'In der Pflegeeinrichtung'],

                        },
                        options: {
                            title: {
                                display: true,
                                text: (unescape("St%FCrze im Dezember 2013 gesamt")),
                            }
                        }
                    });

                    chartDown = new Chart(document.getElementById("down-chart"), {
                        type: 'bar',
                        data: {
                            labels: [(unescape("m%E4nnlich")), "weiblich"],
                            datasets: [
                                {
                                    label: "Geschlecht",
                                    data: [male[0] + male[1], female[0] + female[1]],
                                    backgroundColor: ["lightblue", "#c45850"]
                                }
                            ]
                        },
                        options: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Geschlechterverteilung gesamt'
                            },
                            scales: {
                                yAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    max: 110,
                                    steps:10
                                    }
                                }]
                            }
                        }
                    });

                }else {
                    chartDown = new Chart(document.getElementById("down-chart"), {
                        type: 'bar',
                        data: {
                            labels: ["keine Angaben", "Marcoumar", "ThromboAss", "Lovenox", "Daflon", "Mulit"],
                            datasets: [
                                {
                                    label: "Medikation",
                                    data: [noDetails[0], marcoumar[0], thromboAss[0], lovenox[0], daflon[0], mulit[0]],
                                    backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850", "lightblue"]
                                }
                            ]
                        },
                        options: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'eingenommene Medikation bei Sturz'
                            }
                        }
                    });
                    chartUp = new Chart(document.getElementById("up-chart"), {
                        type: 'bar',
                        data: {
                            labels: [(unescape("m%E4nnlich")), "weiblich"],
                            datasets: [
                                {
                                    label: "Geschlecht",
                                    data: [male[0], female[0]],
                                    backgroundColor: ["lightblue", "#c45850"]
                                }
                            ]
                        },
                        options: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Geschlechterverteilung'
                            },
                            scales: {
                                yAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    max: 110,
                                    steps:10
                                    }
                                }]
                            }
                        }
                    });
                }
                zoomed = !zoomed;
            });
            
        nursing.attr("class", "nursing")
            .select("g.plus").on("click", function (event) {
                d3.select(this).select("line.plus").attr("stroke", zoomed ? "blue" : "none");
                d3.select("#all").transition().duration(750).attr("transform", zoomed ? "" : "translate(-685 -320) scale(2.2 2.2)");
                d3.select("image.vienna").transition().duration(750).style("opacity", zoomed ? "1" : "0");
                home.transition().duration(750).style("opacity", zoomed ? "1" : "0");
                chartUp.destroy();
                chartDown.destroy();
                if (zoomed) {
                    chartUp = new Chart(document.getElementById('up-chart'), {
                        type: "pie",
                        data: {
                            datasets: [{
                                label: 'test',
                                data: [homeCount, nursingCount],
                                backgroundColor: ['#3cba9f', '#3e95cd']
                            }, {

                            }],
                            labels: ['Zu Hause', 'In der Pflegeeinrichtung'],

                        },
                        options: {
                            title: {
                                display: true,
                                text: (unescape("St%FCrze im Dezember 2013 gesamt")),
                            }
                        }
                    });

                    chartDown = new Chart(document.getElementById("down-chart"), {
                        type: 'bar',
                        data: {
                            labels: [(unescape("m%E4nnlich")), "weiblich"],
                            datasets: [
                                {
                                    label: "Geschlecht",
                                    data: [male[0] + male[1], female[0] + female[1]],
                                    backgroundColor: ["lightblue", "#c45850"]
                                }
                            ]
                        },
                        options: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Geschlechterverteilung gesamt'
                            },
                            scales: {
                                yAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    max: 110,
                                    steps:10
                                    }
                                }]
                            }
                        }
                    });
                } else {
                    chartDown = new Chart(document.getElementById("down-chart"), {
                        type: 'bar',
                        data: {
                            labels: ["keine Angaben", "Marcoumar", "ThromboAss", "Lovenox", "Daflon", "Mulit"],
                            datasets: [
                                {
                                    label: "Medikation",
                                    data: [noDetails[1], marcoumar[1], thromboAss[1], lovenox[1], daflon[1], mulit[1]],
                                    backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850", "lightblue"]
                                }
                            ]
                        },
                        options: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'eingenommene Medikation bei Sturz'
                            }
                        }
                    });
                    chartUp = new Chart(document.getElementById("up-chart"), {
                        type: 'bar',
                        data: {
                            labels: [(unescape("m%E4nnlich")), "weiblich"],
                            datasets: [
                                {
                                    label: "Geschlecht",
                                    data: [male[1], female[1]],
                                    backgroundColor: ["lightblue", "#c45850"]
                                }
                            ]
                        },
                        options: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Geschlechterverteilung'
                            },
                            scales: {
                                yAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    max: 110,
                                    steps:10
                                    }
                                }]
                            }
                        }
                    });    
                }
                zoomed = !zoomed;
            });

        // Define the div for the tooltip
        var tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        d3.selectAll("g.circles").selectAll("circle")
            .on("mouseover", function (d) {
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                tooltip.html("Verletzungen: <br/>" + d3.select(this).attr("count"))
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
            })
            .on("mouseout", function (d) {
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });

        var percentColors = [
            { pct: 0.0, color: { r: 0xff, g: 0x00, b: 0 } },
            { pct: 0.5, color: { r: 0xff, g: 0xff, b: 0 } },
            { pct: 1.0, color: { r: 0x00, g: 0xff, b: 0 } }];

        var getColorForPercentage = function (pct) {
            for (var i = 1; i < percentColors.length - 1; i++) {
                if (pct < percentColors[i].pct) {
                    break;
                }
            }
            var lower = percentColors[i - 1];
            var upper = percentColors[i];
            var range = upper.pct - lower.pct;
            var rangePct = (pct - lower.pct) / range;
            var pctLower = 1 - rangePct;
            var pctUpper = rangePct;
            var color = {
                r: Math.floor(lower.color.r * pctLower + upper.color.r * pctUpper),
                g: Math.floor(lower.color.g * pctLower + upper.color.g * pctUpper),
                b: Math.floor(lower.color.b * pctLower + upper.color.b * pctUpper)
            };
            return 'rgb(' + [color.r, color.g, color.b].join(',') + ')';
            // or output as hex if preferred

        }


        d3.selectAll("canvas").attr("width", window.innerWidth * 0.35).attr("height", window.innerHeight * 0.45);

        d3.dsv(";", "Sturzdaten.csv")
            .then(function (data) {
                console.log(data);



                for (var i = 0; i < data.length; i++) {
                    var residence;
                    //STÜRZE 
                    if (data[i].Residence == "1") {
                        nursingCount++;
                        residence = 1;
                    } else if (data[i].Residence == "2") {
                        homeCount++;
                        residence = 0;
                    }


                    //VERLETZUNGEN IN KÖRPERREGIONEN
                    while (data[i].Bodypart.indexOf(" ") != -1) {
                        data[i].Bodypart = data[i].Bodypart.replace(" ", "");
                    }
                    var bodyparts = data[i].Bodypart.split(",");
                    for (var j = 0; j < bodyparts.length; j++) {
                        var bodypart = parseInt(bodyparts[j]);
                        if (bodypart == 2 || bodypart == 3) {
                            head[residence]++;
                        } else if (bodypart >= 6 && bodypart <= 15) {
                            upperEx[residence]++;
                        } else if (bodypart >= 16 && bodypart <= 25) {
                            lowerEx[residence]++;
                        } else if (bodypart == 4 || bodypart == 5 || bodypart == 26 || bodypart == 27) {
                            back[residence]++;
                        }
                    }

                    //KÖRPERREGIONEN IM DETAIL
                    while (data[i].Bodypart.indexOf(" ") != -1) {
                        data[i].Bodypart = data[i].Bodypart.replace(" ", "");
                    }
                    var bodypartsDetail = data[i].Bodypart.split(",");
                    for (var j = 0; j < bodyparts.length; j++) {
                        var bodypart = parseInt(bodypartsDetail[j]);
                        if (bodypart == 2) {
                            headInj[residence]++;
                        } else if (bodypart == 3) {
                            face[residence]++;
                        } else if (bodypart == 6 || bodypart == 7) {
                            shoulder[residence]++;
                        } else if (bodypart == 4) {
                            chest[residence]++;
                        } else if (bodypart == 5) {
                            spine[residence]++;
                        } else if (bodypart == 8 || bodypart == 9) {
                            elbow[residence]++;
                        } else if (bodypart == 10 || bodypart == 11) {
                            arm[residence]++;
                        } else if (bodypart >= 12 && bodypart <= 15) {
                            hand[residence]++;
                        } else if (bodypart == 16 || bodypart == 17) {
                            hips[residence]++;
                        } else if (bodypart == 18 || bodypart == 19) {
                            tigh[residence]++;
                        } else if (bodypart == 20 || bodypart == 21) {
                            knees[residence]++;
                        } else if (bodypart == 22 || bodypart == 23) {
                            feet[residence]++;
                        } else if (bodypart == 24 || bodypart == 25) {
                            leg[residence]++;
                        } else if (bodypart == 26) {
                            backInj[residence]++;
                        } else if (bodypart == 27) {
                            neck[residence]++;
                        }

                    }


                    //GESCHLECHT
                    while (data[i].Gender.indexOf(" ") != -1) {
                        data[i].Gender = data[i].Gender.replace(" ", "");
                    }
                    var gender = data[i].Gender.split(",");
                    for (var k = 0; k < gender.length; k++) {
                        var gender = parseInt(gender[k]);
                        if (gender == "1") {
                            female[residence]++;
                        } else if (gender == "2") {
                            male[residence]++;
                        }
                    }

                    // MEDIKAMENTE
                    while (data[i].Medication.indexOf(" ") != -1) {
                        data[i].Medication = data[i].Medication.replace(" ", "");
                    }
                    var medicine = data[i].Medication.split(",");
                    for (var n = 0; n < medicine.length; n++) {
                        var medicine = parseInt(medicine[n]);
                        if (medicine == 0) {
                            noDetails[residence]++;
                        } else if (medicine == 1) {
                            marcoumar[residence]++;
                        } else if (medicine == 2) {
                            thromboAss[residence]++;
                        } else if (medicine == 3) {
                            lovenox[residence]++;
                        } else if (medicine == 4) {
                            daflon[residence]++;
                        } else if (medicine == 5) {
                            mulit[residence]++
                        }
                    }

                }

                //STÜRZE
                home.select("text.falls").text(homeCount);
                nursing.select("text.falls").text(nursingCount);




                chartUp = new Chart(document.getElementById('up-chart'), {
                    type: "pie",
                    data: {
                        datasets: [{
                            label: 'test',
                            data: [homeCount, nursingCount],
                            backgroundColor: ['#3cba9f', '#3e95cd']
                        }, {

                        }],
                        labels: ['Zu Hause', 'In der Pflegeeinrichtung'],

                    },
                    options: {
                        title: {
                            display: true,
                            text: (unescape("St%FCrze im Dezember 2013 gesamt")),
                        }
                    }
                });

                chartDown = new Chart(document.getElementById("down-chart"), {
                    type: 'bar',
                    data: {
                        labels: [(unescape("m%E4nnlich")), "weiblich"],
                        datasets: [
                            {
                                label: "Geschlecht",
                                data: [male[0] + male[1], female[0] + female[1]],
                                backgroundColor: ["lightblue", "#c45850"]
                               }
                        ]
                    },
                    options: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Geschlechterverteilung gesamt'
                        },
                        scales: {
                            yAxes: [{                              
                                ticks: {
                                min: 0,
                                max: 110,
                                steps:10
                                }
                            }]
                        }
                    }
                });

                //VERLETZUNGEN
                home.select("circle.head").attr("count", head[0]).attr("fill", getColorForPercentage(head[0] / data.length)).attr("r", 1 + 40 * head[0] / data.length).on("click", function () {
                    if (zoomed) {
                        chartUp.destroy();
                        chartUp = new Chart(document.getElementById("up-chart"), {
                            type: 'horizontalBar',
                            data: {
                                labels: ["Kopf", "Gesicht"],
                                datasets: [
                                    {
                                        label: "Kopfverletzungen im Detail",
                                        data: [headInj[0], face[0]],
                                        backgroundColor: ["#3e95cd", "#8e5ea2"]
                                    }
                                ]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: 'Kopfverletzungen im Detail'
                                },
                                scales: {
                                xAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    steps:1
                                    }
                                    }]
                                }
                            }
                        });
                    }
                });

                nursing.select("circle.head").attr("count", head[1]).attr("fill", getColorForPercentage(head[1] / data.length)).attr("r", 1 + 40 * head[1] / data.length).on("click", function () {
                    if (zoomed) {
                        chartUp.destroy();
                        chartUp = new Chart(document.getElementById("up-chart"), {
                            type: 'horizontalBar',
                            data: {
                                labels: ["Kopf", "Gesicht"],
                                datasets: [
                                    {
                                        label: "Kopfverletzungen im Detail",
                                        data: [headInj[1], face[1]],
                                        backgroundColor: ["#3e95cd", "#8e5ea2"]
                                    }
                                ]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: 'Kopfverletzungen im Detail'
                                },
                                scales: {
                                xAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    steps:1
                                    }
                                    }]
                                }
                            }
                        });
                    }
                });

                home.select("circle.upperEx").attr("count", upperEx[0]).attr("fill", getColorForPercentage(upperEx[0] / data.length)).attr("r", 1 + 40 * upperEx[0] / data.length).on("click", function () {
                    if (zoomed) {
                        chartUp.destroy();
                        chartUp = new Chart(document.getElementById("up-chart"), {
                            type: 'horizontalBar',
                            data: {
                                labels: ["Schulter", "Arm", "Ellbogen", "Hand"],
                                datasets: [
                                    {
                                        label: (unescape("Verletzungen der oberen Extremit%E4ten im Detail")),
                                        data: [shoulder[0], arm[0], elbow[0], hand[0]],
                                        backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9"]
                                    }
                                ]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: (unescape("Verletzungen der oberen Extremit%E4t im Detail"))
                                },
                                scales: {
                                xAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    steps:1
                                    }
                                    }]
                                }
                            }
                        });
                    }
                });
                nursing.select("circle.upperEx").attr("count", upperEx[1]).attr("fill", getColorForPercentage(upperEx[1] / data.length)).attr("r", 1 + 40 * upperEx[1] / data.length).on("click", function () {
                    if (zoomed) {
                        chartUp.destroy();
                        chartUp = new Chart(document.getElementById("up-chart"), {
                            type: 'horizontalBar',
                            data: {
                                labels: ["Schulter", "Arm", "Ellbogen", "Hand"],
                                datasets: [
                                    {
                                        label: (unescape("Verletzungen der oberen Extremit%E4t im Detail")),
                                        data: [shoulder[1], arm[1], elbow[1], hand[1]],
                                        backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9"]
                                    }
                                ]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: (unescape("Verletzungen der oberen Extremit%E4t im Detail"))
                                },
                                scales: {
                                xAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    steps:1
                                    }
                                    }]
                                }
                            }
                        });
                    }
                });

                home.select("circle.lowerEx").attr("count", lowerEx[0]).attr("fill", getColorForPercentage(lowerEx[0] / data.length)).attr("r", 1 + 40 * lowerEx[0] / data.length).on("click", function () {
                    if (zoomed) {
                        chartUp.destroy();
                        chartUp = new Chart(document.getElementById("up-chart"), {
                            type: 'horizontalBar',
                            data: {
                                labels: [(unescape("H%FCfte")), "Oberschenkel", "Knie", (unescape("Fu%DF")), "Bein"],
                                datasets: [
                                    {
                                        label: (unescape("Verletzungen der unteren Extremit%E4t im Detail")),
                                        data: [hips[0], tigh[0], knees[0], feet[0], leg[0]],
                                        backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"]
                                    }
                                ]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: (unescape("Verletzungen der unteren Extremit%E4t im Detail"))
                                },
                                scales: {
                                xAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    steps:1
                                    }
                                    }]
                                }
                            }
                        });
                    }
                });
                nursing.select("circle.lowerEx").attr("count", lowerEx[1]).attr("fill", getColorForPercentage(lowerEx[1] / data.length)).attr("r", 1 + 40 * lowerEx[1] / data.length).on("click", function () {
                    if (zoomed) {
                        chartUp.destroy();
                        chartUp = new Chart(document.getElementById("up-chart"), {
                            type: 'horizontalBar',
                            data: {
                                labels: [(unescape("H%FCfte")), "Oberschenkel", "Knie", (unescape("Fu%DF")), "Bein"],
                                datasets: [
                                    {
                                        label: (unescape("Verletzungen der unteren Extremit%E4t im Detail")),
                                        data: [hips[1], tigh[1], knees[1], feet[1], leg[1]],
                                        backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"]
                                    }
                                ]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: (unescape("Verletzungen der unteren Extremit%E4t im Detail"))
                                },
                                scales: {
                                xAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    steps:1
                                    }
                                    }]
                                }
                            }
                        });
                    }
                });

                home.select("circle.back").attr("count", back[0]).attr("fill", getColorForPercentage(back[0] / data.length)).attr("r", 1 + 40 * back[0] / data.length).on("click", function () {
                    if (zoomed) {
                        chartUp.destroy();
                        chartUp = new Chart(document.getElementById("up-chart"), {
                            type: 'horizontalBar',
                            data: {
                                labels: [(unescape("R%FCcken")), "Nacken", "Brust", (unescape("Wirbels%E4ule"))],
                                datasets: [
                                    {
                                        label: "Verletzungen am Rumpf im Detail",
                                        data: [backInj[0], neck[0], chest[0], spine[0]],
                                        backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9"]
                                    }
                                ]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: 'Verletzungen am Rumpf im Detail'
                                },
                                scales: {
                                xAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    steps:1
                                    }
                                    }]
                                }
                            }
                        });
                    }
                });
                nursing.select("circle.back").attr("count", back[1]).attr("fill", getColorForPercentage(back[1] / data.length)).attr("r", 1 + 40 * back[1] / data.length).on("click", function () {
                    if (zoomed) {
                        chartUp.destroy();
                        chartUp = new Chart(document.getElementById("up-chart"), {
                            type: 'horizontalBar',
                            data: {
                                labels: [(unescape("R%FCcken")), "Nacken", "Brust", (unescape("Wirbels%E4ule"))],
                                datasets: [
                                    {
                                        label: "Verletzungen am Rumpf im Detail",
                                        data: [backInj[1], neck[1], chest[1], spine[1]],
                                        backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9"]
                                    }
                                ]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: 'Verletzungen am Rumpf im Detail'
                                },
                                scales: {
                                xAxes: [{                              
                                    ticks: {
                                    min: 0,
                                    steps:1
                                    }
                                    }]
                                }
                            }
                        });
                    }
                });
            });
    </script>
         
   </body>

</html>